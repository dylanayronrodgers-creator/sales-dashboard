<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Agent Interface — Axxess</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    /* Reuse purple index look */
    :root { --bg1:#667eea; --bg2:#764ba2; --card:#fff; }
    *{box-sizing:border-box;}
    body{
      margin:0;
      min-height:100vh;
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      background: linear-gradient(135deg,var(--bg1),var(--bg2));
      display:flex; align-items:center; justify-content:center; padding:24px; color:#0f172a;
    }
    .panel{
      width:100%; max-width:820px; background: rgba(255,255,255,0.95); border-radius:16px; padding:20px; box-shadow:0 12px 30px rgba(0,0,0,0.2);
    }
    header{display:flex; gap:12px; align-items:center; margin-bottom:14px;}
    header img{width:64px;height:64px;border-radius:8px;object-fit:cover;box-shadow:0 8px 20px rgba(0,0,0,0.18);}
    h1{margin:0;color:#111827;}
    .muted{color:#6b7280;font-size:13px;}
    .row{display:flex;gap:12px;flex-wrap:wrap;margin-top:12px;}
    select,input{padding:10px;border-radius:10px;border:1px solid #e6e6f0;width:100%;}
    .col { flex:1; min-width:180px; }
    .btn { background: linear-gradient(90deg,var(--bg1),var(--bg2)); color:white;border:0;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:600; }
    .info { background:#f8fafc;padding:12px;border-radius:10px;border:1px solid #eef2ff; }
    .progressBar { width:100%; background:#eef2ff;height:14px;border-radius:999px;overflow:hidden; }
    .progress { height:100%; background:linear-gradient(90deg,#34d399,#3b82f6); }
    .danger { background:#ef4444; color:white; padding:8px 10px; border-radius:8px; cursor:pointer; border:0; }
    .small { font-size:13px; color:#6b7280; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // agent data: localStorage keys 'agent:<id>' => {id,name,department,target,sales,password,createdAt}
    function AgentInterface(){
      const [agents, setAgents] = useState([]);
      const [selectedId, setSelectedId] = useState('');
      const [locked, setLocked] = useState(true);
      const [password, setPassword] = useState('');
      const [current, setCurrent] = useState(null);
      const [saleAmount, setSaleAmount] = useState('');
      const [message, setMessage] = useState('');

      useEffect(()=> {
        loadAgents();
        const onStorage = (e) => {
          if (e.key && e.key.startsWith('agent:')) loadAgents();
        };
        window.addEventListener('storage', onStorage);
        return () => window.removeEventListener('storage', onStorage);
      }, []);

      function loadAgents(){
        const keys = Object.keys(localStorage).filter(k=>k.startsWith('agent:'));
        const data = keys.map(k => JSON.parse(localStorage.getItem(k)));
        // sort by name
        data.sort((a,b)=> (a.name||'').localeCompare(b.name||''));
        setAgents(data);
        // if current exists, refresh
        if (selectedId){
          const found = data.find(d=>d.id===selectedId);
          setCurrent(found || null);
        }
      }

      function unlock(){
        if (!selectedId){
          alert('Pick an agent from the dropdown first');
          return;
        }
        const a = agents.find(x => x.id === selectedId);
        if (!a){
          alert('Agent not found (maybe deleted). Refresh page.');
          return;
        }
        if (a.password === password){
          setCurrent(a);
          setLocked(false);
          setPassword('');
          setMessage('');
        } else {
          setMessage('Incorrect password');
        }
      }

      function logout(){
        setLocked(true);
        setCurrent(null);
        setSelectedId('');
        setPassword('');
        setSaleAmount('');
        setMessage('');
      }

      function addSale(){
        if (!current) return;
        const num = Number(saleAmount);
        if (!num || num <= 0){
          setMessage('Enter a valid sale amount');
          return;
        }
        const updated = {...current, sales: (Number(current.sales || 0) + num)};
        localStorage.setItem(`agent:${current.id}`, JSON.stringify(updated));
        setCurrent(updated);
        setSaleAmount('');
        setMessage(`Sale of R${num.toLocaleString()} recorded`);
        // notify other tabs (storage event won't fire on same tab), so we set then remove a marker
        localStorage.setItem('__axxess_last_update', String(Date.now()));
      }

      const progress = current && current.target ? (Number(current.sales || 0) / Number(current.target)) * 100 : 0;

      return (
        <div className="panel">
          <header>
            <img src="https://ibb.co/Wvkq30CR" alt="Axxess Logo" />
            <div>
              <h1>Axxess — Sales Agent</h1>
              <div className="muted">Use your agent password to unlock your dashboard</div>
            </div>
          </header>

          <div style={{marginTop:8}}>
            <div className="row">
              <div className="col">
                <label className="small">Select Agent</label>
                <select value={selectedId} onChange={e=>{ setSelectedId(e.target.value); setLocked(true); setCurrent(null); setMessage(''); }}>
                  <option value="">-- Choose agent --</option>
                  {agents.map(a => <option key={a.id} value={a.id}>{a.name} — {a.department}</option>)}
                </select>
              </div>
              <div className="col" style={{minWidth:220}}>
                <label className="small">Agent Password</label>
                <input type="password" value={password} placeholder="Enter agent password" onChange={e=>setPassword(e.target.value)} />
              </div>
              <div style={{display:'flex', alignItems:'flex-end', gap:8}}>
                <button className="btn" onClick={unlock} disabled={!selectedId}>Unlock</button>
                <button className="danger" onClick={logout}>Logout</button>
              </div>
            </div>

            {message && <div style={{marginTop:12}} className="small">{message}</div>}

            {!locked && current ? (
              <div style={{marginTop:18, display:'grid', gridTemplateColumns:'1fr 320px', gap:16}}>
                <div>
                  <div className="info">
                    <div style={{display:'flex', justifyContent:'space-between', alignItems:'center'}}>
                      <div>
                        <div style={{fontSize:18, fontWeight:700}}>{current.name}</div>
                        <div className="muted">{current.department}</div>
                      </div>
                      <div style={{textAlign:'right'}}>
                        <div className="small">Target</div>
                        <div style={{fontWeight:700}}>R {Number(current.target).toLocaleString()}</div>
                        <div className="small" style={{marginTop:6}}>Sales: R {Number(current.sales || 0).toLocaleString()}</div>
                      </div>
                    </div>

                    <div style={{marginTop:12}}>
                      <div className="small">Progress</div>
                      <div className="progressBar" style={{marginTop:8}}>
                        <div className="progress" style={{width: Math.min(progress,100) + '%'}} />
                      </div>
                      <div style={{marginTop:8, fontWeight:700}}>{progress.toFixed(1)}%</div>
                    </div>
                  </div>

                  <div style={{marginTop:12}}>
                    <label className="small">Log Sale (R)</label>
                    <div style={{display:'flex', gap:8}}>
                      <input type="number" value={saleAmount} onChange={e=>setSaleAmount(e.target.value)} placeholder="Amount" />
                      <button className="btn" onClick={addSale}>Add</button>
                    </div>
                    <div className="small" style={{marginTop:8}}>Sales you log update the TV dashboard automatically.</div>
                  </div>
                </div>

                <div>
                  <div className="info">
                    <div style={{fontWeight:700}}>Quick Stats</div>
                    <div style={{marginTop:10}}>
                      <div className="small">Target</div>
                      <div>R {Number(current.target).toLocaleString()}</div>
                    </div>
                    <div style={{marginTop:10}}>
                      <div className="small">Sales</div>
                      <div>R {Number(current.sales || 0).toLocaleString()}</div>
                    </div>
                    <div style={{marginTop:10}}>
                      <div className="small">Last updated</div>
                      <div className="small muted">{ new Date(current.createdAt || Date.now()).toLocaleString() }</div>
                    </div>
                  </div>
                </div>
              </div>
            ) : (
              <div style={{marginTop:18}} className="muted">Select your name and enter your password to access your personal dashboard.</div>
            )}
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<AgentInterface />);
  </script>
</body>
</html>

