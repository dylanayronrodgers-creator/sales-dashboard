<!DOCTYPE html>

<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sales Agent Interface</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    function SalesAgentInterface() {
      const [agentName, setAgentName] = useState('');
      const [department, setDepartment] = useState('');
      const [target, setTarget] = useState('');
      const [saleAmount, setSaleAmount] = useState('');
      const [currentAgent, setCurrentAgent] = useState(null);
      const [message, setMessage] = useState('');
      const [loading, setLoading] = useState(false);

      useEffect(() => {
        loadAgentData();
      }, [agentName, department]);

      const loadAgentData = () => {
        if (!agentName.trim() || !department) {
          setCurrentAgent(null);
          return;
        }

        const key = `agent:${department}:${agentName.toLowerCase()}`;
        const data = localStorage.getItem(key);
        if (data) {
          setCurrentAgent(JSON.parse(data));
        } else {
          setCurrentAgent(null);
        }
      };

      const handleSetTarget = () => {
        if (!agentName.trim() || !department || !target) {
          setMessage('Please enter your name, department, and target amount');
          return;
        }

        setLoading(true);
        const agentData = {
          name: agentName,
          department,
          target: parseFloat(target),
          sales: currentAgent?.sales || 0,
          lastUpdated: new Date().toISOString()
        };
        localStorage.setItem(`agent:${department}:${agentName.toLowerCase()}`, JSON.stringify(agentData));
        setCurrentAgent(agentData);
        setMessage('Target set successfully!');
        setTarget('');
        setLoading(false);
      };

      const handleAddSale = () => {
        if (!agentName.trim() || !department || !saleAmount) {
          setMessage('Please enter your name, department, and sale amount');
          return;
        }

        if (!currentAgent) {
          setMessage('Please set your target first');
          return;
        }

        setLoading(true);
        const updated = {
          ...currentAgent,
          sales: currentAgent.sales + parseFloat(saleAmount),
          lastUpdated: new Date().toISOString()
        };
        localStorage.setItem(`agent:${department}:${agentName.toLowerCase()}`, JSON.stringify(updated));
        setCurrentAgent(updated);
        setMessage(`Sale of R${parseFloat(saleAmount).toLocaleString()} added successfully!`);
        setSaleAmount('');
        setLoading(false);
      };

      const progress = currentAgent ? (currentAgent.sales / currentAgent.target) * 100 : 0;

      return (
        <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-green-50 to-yellow-100 p-6">
          <div className="bg-white rounded-2xl shadow-xl p-6 w-full max-w-md">
            <h1 className="text-2xl font-bold text-center mb-6 text-green-700">Sales Agent Dashboard</h1>

            <div className="mb-4">
              <label className="block text-sm font-medium mb-1">Your Name</label>
              <input
                type="text"
                value={agentName}
                onChange={(e) => setAgentName(e.target.value)}
                className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500"
              />
            </div>

            <div className="mb-4">
              <label className="block text-sm font-medium mb-1">Department</label>
              <select
                value={department}
                onChange={(e) => setDepartment(e.target.value)}
                className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500"
              >
                <option value="">Select Department</option>
                <option value="sales">Sales</option>
                <option value="marketing">Marketing</option>
                <option value="support">Support</option>
              </select>
            </div>

            <div className="mb-4">
              <label className="block text-sm font-medium mb-1">Set Target (R)</label>
              <input
                type="number"
                value={target}
                onChange={(e) => setTarget(e.target.value)}
                className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500"
              />
              <button
                onClick={handleSetTarget}
                disabled={loading}
                className="mt-2 w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700"
              >
                {loading ? 'Saving...' : 'Set Target'}
              </button>
            </div>

            <div className="mb-4">
              <label className="block text-sm font-medium mb-1">Add Sale (R)</label>
              <input
                type="number"
                value={saleAmount}
                onChange={(e) => setSaleAmount(e.target.value)}
                className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500"
              />
              <button
                onClick={handleAddSale}
                disabled={loading}
                className="mt-2 w-full bg-yellow-500 text-white py-2 rounded-lg hover:bg-yellow-600"
              >
                {loading ? 'Adding...' : 'Add Sale'}
              </button>
            </div>

            {currentAgent && (
              <div className="mb-4 text-center">
                <p className="font-medium">Progress: {progress.toFixed(1)}%</p>
                <div className="w-full bg-gray-200 rounded-full h-3 mt-2">
                  <div
                    className="bg-green-500 h-3 rounded-full"
                    style={{ width: `${Math.min(progress, 100)}%` }}
                  ></div>
                </div>
                <p className="mt-2 text-sm text-gray-700">
                  Sales: R{currentAgent.sales.toLocaleString()} / R{currentAgent.target.toLocaleString()}
                </p>
              </div>
            )}

            {message && <p className="text-center text-sm text-gray-700 mt-2">{message}</p>}
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<SalesAgentInterface />);
  </script>

</body>
</html>
