<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Management Console</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    /* Purple index-like visual to match your index page */
    :root {
      --bg1: #667eea;
      --bg2: #764ba2;
      --card: #ffffff;
    }
    * { box-sizing: border-box; }
    body {
      margin:0;
      min-height:100vh;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(135deg,var(--bg1) 0%, var(--bg2) 100%);
      color:#111827;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
    }
    .shell {
      width:100%;
      max-width:980px;
      background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
      border-radius:18px;
      padding:22px;
      box-shadow:0 10px 30px rgba(0,0,0,0.25);
      border:1px solid rgba(255,255,255,0.06);
      color: #0f172a;
    }
    header { display:flex; align-items:center; gap:14px; margin-bottom:18px; }
    header img { width:58px; height:58px; border-radius:8px; object-fit:cover; box-shadow:0 4px 12px rgba(0,0,0,0.18); }
    h1 { font-size:20px; margin:0; color:white; }
    .section { background: white; border-radius:12px; padding:16px; margin-bottom:14px; }
    label { display:block; font-size:13px; margin-bottom:6px; color:#374151; }
    input[type="text"], input[type="number"], input[type="password"], select {
      width:100%; padding:10px 12px; border-radius:8px; border:1px solid #e6e6f0; outline:none;
    }
    .grid { display:grid; gap:12px; grid-template-columns: 1fr 1fr; }
    .full { grid-column: 1 / -1; }
    button {
      background: linear-gradient(90deg,var(--bg1),var(--bg2));
      color:white; border:0; padding:10px 14px; border-radius:10px; cursor:pointer; font-weight:600;
    }
    table { width:100%; border-collapse:collapse; font-size:14px; }
    th, td { padding:8px 10px; text-align:left; border-bottom:1px solid #eef2ff; }
    .actions button { margin-right:6px; }
    .small { font-size:13px; color:#6b7280; }
    .danger { background: #ef4444; box-shadow:none; }
    .muted { color:#6b7280; font-size:13px; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // Utility: keys in localStorage will be 'agent:<id>'
    const ADMIN_PIN = 'admin123'; // change as required

    function ManagementConsole(){
      const [auth, setAuth] = useState(false);
      const [pin, setPin] = useState('');
      const [agents, setAgents] = useState([]);
      const [loading, setLoading] = useState(true);

      const [form, setForm] = useState({
        id: '',
        name: '',
        department: 'Sales',
        target: '',
        password: ''
      });

      useEffect(()=> {
        if (auth) loadAgents();
      }, [auth]);

      useEffect(()=> {
        // listen for storage updates from other tabs
        const onStorage = (e) => {
          if (e.key && e.key.startsWith('agent:')) loadAgents();
        };
        window.addEventListener('storage', onStorage);
        return () => window.removeEventListener('storage', onStorage);
      }, []);

      function loadAgents(){
        setLoading(true);
        const keys = Object.keys(localStorage).filter(k => k.startsWith('agent:'));
        const data = keys.map(k => JSON.parse(localStorage.getItem(k)));
        // sort by createdAt descending
        data.sort((a,b) => (b.createdAt || 0) - (a.createdAt || 0));
        setAgents(data);
        setLoading(false);
      }

      function attemptLogin(){
        if (pin === ADMIN_PIN){
          setAuth(true);
          setPin('');
        } else {
          alert('Incorrect admin PIN');
        }
      }

      function saveAgent(){
        if (!form.name.trim() || !form.target || !form.password.trim()){
          alert('Please fill name, target and password');
          return;
        }
        // if editing use id, else create id
        const id = form.id || `agent_${Date.now()}`;
        const agent = {
          id,
          name: form.name.trim(),
          department: form.department,
          target: Number(form.target),
          sales: 0,
          password: form.password, // plaintext per request
          createdAt: Date.now()
        };
        localStorage.setItem(`agent:${id}`, JSON.stringify(agent));
        setForm({ id:'', name:'', department:'Sales', target:'', password:'' });
        loadAgents();
        alert('Agent saved');
      }

      function editAgent(a){
        setForm({
          id: a.id,
          name: a.name,
          department: a.department,
          target: a.target,
          password: a.password
        });
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }

      function deleteAgent(a){
        if (!confirm(`Delete agent ${a.name}? This cannot be undone.`)) return;
        localStorage.removeItem(`agent:${a.id}`);
        loadAgents();
      }

      function resetSales(a){
        if (!confirm(`Reset sales for ${a.name}?`)) return;
        const updated = {...a, sales:0};
        localStorage.setItem(`agent:${a.id}`, JSON.stringify(updated));
        loadAgents();
      }

      return (
        <div className="shell">
          <header>
            <img src="https://i.ibb.co/1GrhnMc4/images.jpg" alt="images" border="0">
            <div>
              <h1 style={{margin:0,color:'white'}}>Axxess â€” Management Console</h1>
              <div className="small" style={{color:'rgba(255,255,255,0.85)'}}>Create agents, set targets and agent passwords</div>
            </div>
          </header>

          {!auth ? (
            <div style={{marginTop:14}} className="section">
              <label>Admin PIN</label>
              <input type="password" value={pin} onChange={e=>setPin(e.target.value)} placeholder="Enter admin PIN" />
              <div style={{marginTop:10}}>
                <button onClick={attemptLogin}>Unlock Management</button>
              </div>
            </div>
          ) : (
            <>
              <div className="section">
                <div style={{display:'flex', justifyContent:'space-between', alignItems:'center', marginBottom:10}}>
                  <div>
                    <strong>New / Edit Agent</strong>
                    <div className="muted">Passwords are stored in plain text (localStorage) per your request.</div>
                  </div>
                  <div>
                    <button onClick={()=>{ setAuth(false); setAgents([]); }}>Lock</button>
                  </div>
                </div>

                <div className="grid">
                  <div>
                    <label>Agent Name</label>
                    <input type="text" value={form.name} onChange={e=>setForm({...form, name:e.target.value})} />
                  </div>
                  <div>
                    <label>Department</label>
                    <select value={form.department} onChange={e=>setForm({...form, department:e.target.value})}>
                      <option>Sales</option>
                      <option>Client Care</option>
                      <option>Marketing</option>
                      <option>Support</option>
                    </select>
                  </div>
                  <div>
                    <label>Target (R)</label>
                    <input type="number" value={form.target} onChange={e=>setForm({...form, target:e.target.value})} />
                  </div>
                  <div>
                    <label>Agent Password (plaintext)</label>
                    <input type="password" value={form.password} onChange={e=>setForm({...form, password:e.target.value})} />
                  </div>
                  <div className="full" style={{display:'flex', gap:8}}>
                    <button onClick={saveAgent}>Save Agent</button>
                    <button onClick={()=>setForm({id:'', name:'', department:'Sales', target:'', password:''})} style={{background:'#6b7280'}}>Clear</button>
                  </div>
                </div>
              </div>

              <div className="section">
                <div style={{display:'flex', justifyContent:'space-between', alignItems:'center', marginBottom:8}}>
                  <strong>Agents</strong>
                  <div className="small">Total: {agents.length}</div>
                </div>

                {loading ? <div className="small">Loading...</div> : (
                  agents.length === 0 ? <div className="muted">No agents yet</div> : (
                    <table>
                      <thead>
                        <tr>
                          <th>Name</th>
                          <th>Dept</th>
                          <th>Target (R)</th>
                          <th>Sales (R)</th>
                          <th className="small">Actions</th>
                        </tr>
                      </thead>
                      <tbody>
                        {agents.map(a => (
                          <tr key={a.id}>
                            <td>{a.name}</td>
                            <td>{a.department}</td>
                            <td>R {Number(a.target).toLocaleString()}</td>
                            <td>R {Number(a.sales || 0).toLocaleString()}</td>
                            <td className="actions">
                              <button onClick={()=>editAgent(a)}>Edit</button>
                              <button onClick={()=>resetSales(a)} style={{background:'#f59e0b'}}>Reset</button>
                              <button onClick={()=>deleteAgent(a)} className="danger">Delete</button>
                            </td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  )
                )}
              </div>
            </>
          )}
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<ManagementConsole />);
  </script>
</body>
</html>


