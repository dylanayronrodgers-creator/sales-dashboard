<!DOCTYPE html>

<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sales TV Dashboard</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    function SalesDashboard() {
      const [agents, setAgents] = useState([]);
      const [loading, setLoading] = useState(true);

      useEffect(() => {
        loadAgents();
        const interval = setInterval(loadAgents, 5000);
        return () => clearInterval(interval);
      }, []);

      const loadAgents = () => {
        const keys = Object.keys(localStorage).filter(k => k.startsWith('agent:'));
        const data = keys.map(k => JSON.parse(localStorage.getItem(k)));
        setAgents(data);
        setLoading(false);
      };

      const calcStats = (deptAgents) => {
        const totalSales = deptAgents.reduce((sum, a) => sum + (a.sales || 0), 0);
        const totalTarget = deptAgents.reduce((sum, a) => sum + (a.target || 0), 0);
        const progress = totalTarget > 0 ? (totalSales / totalTarget) * 100 : 0;
        return { totalSales, totalTarget, progress };
      };

      const sortByProgress = (a, b) => {
        const progressA = a.target > 0 ? (a.sales / a.target) * 100 : 0;
        const progressB = b.target > 0 ? (b.sales / b.target) * 100 : 0;
        return progressB - progressA;
      };

      const salesAgents = agents.filter(a => a.department === 'Sales').sort(sortByProgress);
      const clientAgents = agents.filter(a => a.department === 'Client Care').sort(sortByProgress);

      const overallStats = calcStats(agents);
      const salesStats = calcStats(salesAgents);
      const clientStats = calcStats(clientAgents);

      const Trophy = ({ index }) => {
        const colors = ['text-yellow-400', 'text-gray-400', 'text-amber-600'];
        return index < 3 ? (
          <span className={`text-3xl ${colors[index]}`}>üèÜ</span>
        ) : null;
      };

      const Department = ({ title, color, stats, deptAgents }) => (
        <div className="bg-white rounded-3xl shadow-2xl p-8">
          <h2 className={`text-4xl font-bold flex items-center gap-3 mb-6 ${color}`}>
            üìà {title}
          </h2>
          <div className="grid grid-cols-3 gap-4 text-center mb-6">
            <div>
              <p className="text-gray-500 text-sm">TEAM TARGET</p>
              <p className="text-2xl font-bold">R {stats.totalTarget.toLocaleString()}</p>
            </div>
            <div>
              <p className="text-gray-500 text-sm">TOTAL SALES</p>
              <p className="text-2xl font-bold text-green-600">R {stats.totalSales.toLocaleString()}</p>
            </div>
            <div>
              <p className="text-gray-500 text-sm">PROGRESS</p>
              <p className="text-2xl font-bold text-blue-600">{stats.progress.toFixed(1)}%</p>
            </div>
          </div>

          <div className="bg-gray-200 rounded-full h-4 mb-8 overflow-hidden">
            <div
              className={`h-4 ${
                stats.progress >= 100 ? 'bg-green-600' :
                stats.progress >= 75 ? 'bg-blue-600' :
                stats.progress >= 50 ? 'bg-yellow-500' : 'bg-red-500'
              }`}
              style={{ width: `${Math.min(stats.progress, 100)}%` }}
            />
          </div>

          {deptAgents.length === 0 ? (
            <p className="text-gray-600 italic">No agents found.</p>
          ) : (
            <div className="space-y-4">
              {deptAgents.map((a, i) => {
                const progress = a.target > 0 ? (a.sales / a.target) * 100 : 0;
                return (
                  <div key={a.id} className="bg-gray-50 rounded-xl p-4 shadow flex items-center justify-between">
                    <div className="flex items-center gap-4">
                      <Trophy index={i} />
                      <div>
                        <p className="font-bold text-lg">{a.name}</p>
                        <p className="text-sm text-gray-600">
                          R {a.sales.toLocaleString()} / R {a.target.toLocaleString()}
                        </p>
                      </div>
                    </div>
                    <div className="text-right">
                      <p className="text-lg font-semibold">{progress.toFixed(1)}%</p>
                      <div className="w-32 bg-gray-200 rounded-full h-2 mt-1">
                        <div
                          className={`h-2 rounded-full ${
                            progress >= 100 ? 'bg-green-600' :
                            progress >= 75 ? 'bg-blue-600' :
                            progress >= 50 ? 'bg-yellow-500' : 'bg-red-500'
                          }`}
                          style={{ width: `${Math.min(progress, 100)}%` }}
                        />
                      </div>
                    </div>
                  </div>
                );
              })}
            </div>
          )}
        </div>
      );

      if (loading) {
        return <div className="flex items-center justify-center h-screen text-3xl">Loading...</div>;
      }

      return (
        <div className="min-h-screen p-6 bg-gradient-to-br from-yellow-50 to-green-50">
          <h1 className="text-center text-5xl font-extrabold mb-10 text-green-700 drop-shadow-lg">
            üèÜ Sales TV Dashboard
          </h1>

          <div className="grid lg:grid-cols-2 gap-8">
            <Department title="Sales Department" color="text-green-700" stats={salesStats} deptAgents={salesAgents} />
            <Department title="Client Care Department" color="text-purple-700" stats={clientStats} deptAgents={clientAgents} />
          </div>

          <div className="mt-12 text-center bg-white rounded-3xl shadow-xl py-6">
            <p className="text-xl font-semibold text-gray-700">Overall Company Progress</p>
            <p className="text-4xl font-bold text-green-600 mt-2">{overallStats.progress.toFixed(1)}%</p>
            <div className="w-3/4 mx-auto bg-gray-200 rounded-full h-5 mt-4">
              <div
                className={`h-5 rounded-full ${
                  overallStats.progress >= 100 ? 'bg-green-600' :
                  overallStats.progress >= 75 ? 'bg-blue-600' :
                  overallStats.progress >= 50 ? 'bg-yellow-500' : 'bg-red-500'
                }`}
                style={{ width: `${Math.min(overallStats.progress, 100)}%` }}
              />
            </div>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<SalesDashboard />);
  </script>

</body>
</html>
